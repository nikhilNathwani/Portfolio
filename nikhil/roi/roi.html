<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>ROI</title>
        <script type="text/javascript" src="../d3/d3.js"></script>
        <style type="text/css">
			text {
			    font-family: Verdana;
			}
			
			.axis line {
			    fill: none;
			    stroke: black;
			    shape-rendering: crispEdges;
			}
			
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
		</style>
    </head>
    <body>
        <script type="text/javascript">
            w= 1000;
            h= 1000;
			graphLen= 800;
			
			var colors= {"ATL":"#D21033", "BOS":"#05854C", "BRK":"#000000", "CHA":"#25799A", "CHI":"#D4001F", "CLE":"#9F1425", "DAL":"#006AB5", "DEN":"#4393D1", "DET":"#006BB6", "GSW":"#FFC33C", "HOU":"#CC0000", "IND":"#FFC225", "LAC":"#EE2944", "LAL":"#4A2583", "MEM":"#85A2C6", "MIA":"#B62630", "MIL":"#00330A", "MIN":"#12397F", "NOP": "#091D4A", "NYK":"#2E66B2", "OKC":"#0075C1", "ORL":"#077ABD", "PHI":"#C7974D", "PHO":"#FF7A31", "POR":"#E1393E", "SAC":"#743389", "SAS":"#BEC8C9", "TOR":"#CD1041", "UTA":"#448CCE", "WAS":"#004874"}
            
            //Create SVG element
            svg= d3.select("body")
                    .append("svg")
                    .attr("width",w)
                    .attr("height",h)
                    
            //Graph SVG
            graph= svg.append("svg")
						.attr("id","graph")
                        .attr("width", graphLen) //80%
                        .attr("height", graphLen) //80%
                        .attr("x","5%") //50px
                        .attr("y","5%") //50px
            
			graph.append("line")
					.attr("id","y_equals_x")
					.attr("x1", 20+(10*(800*.9)/45))
					.attr("y1",800*.9)
					.attr("x2","100%")
					.attr("y2","0%")
					.attr("stroke","#777777")
					
			//Toggle SVG
			toggle= svg.append("svg")
						.attr("id","toggle")
						.attr("width","10%")
						.attr("height","100%")
						.attr("x","90%")
						.attr("y","5%")
			
			toggle.append("text")
					.attr("id","XY")
					.attr("x",10)
					.attr("y",10)
					.text("HI")
                    
            
            d3.json("roi.json", function(playerStatsByTeam) {
				var teamGroupDict= {}
				
				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Create a group of circles for each team
				groups= graph.selectAll("g")
							.data(playerStatsByTeam)
							.enter()
							.append("g")
							.attr("class","circs")
							.attr("id", function(d) {
									teamGroupDict[d["team"]]= d3.select(this);
									return d["team"];
								})
				
				function showCoords(d) {
					d3.select("#XY").text(function(){return d["name"];});
				}
				
				//Add circles to each group
				groups.selectAll("circle")
						.data(function(d) {return d["players"];})
						.enter()
						.append("circle")
						.attr("r",3)
						.attr("cx",function(d){
                                val= 20.0+d["ws"]*2;
                                return val+"%";
                            })
                        .attr("cy",function(d){
                                val= 20.0+(35-d["salary"])*2;
                                return val+"%";
                            })
                        .attr("fill",function() {
								return "#777777";
							})
						.on("click",function(d) {
								showCoords(d);
							})
						
				
				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Draw the two axes
					graph.append("g")
						.attr("id", "axisX")
						.attr("class","axis")
					graph.append("g")
						.attr("id", "axisY")
						.attr("class","axis")
					
					var Xscale = d3.scale.linear()
									.domain([-10, 35])
									.range([20, 800*.9]);
					
					var Yscale = d3.scale.linear()
									.domain([45, 0])
									.range([20, 800*.9]);

					var xAxis = d3.svg.axis()
									.scale(Xscale)
									.ticks((120)/4)
									.orient("bottom")
									.tickFormat(d3.format("d"));
					var yAxis = d3.svg.axis()
										.scale(Yscale)
										.ticks((120)/4)
										.orient("left")
										.tickFormat(d3.format("d"));
								
					svg.select("#axisX")
						.attr("transform", "translate("+0+"," + 800*.9 + ")")
						.call(xAxis);	
					svg.select("#axisY")
						.attr("transform", "translate("+ 180 +"," + 0 + ")")
						.call(yAxis);
				
				
				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Create toggle and toggle functionality
				//move selected object to front of parent's layout
				d3.selection.prototype.moveToFront = function() {
					return this.each(function(){
					  this.parentNode.appendChild(this);
					});
				  };
				
				function unZoomAllDots() {
					groups.selectAll("circle")
							.transition().delay(0).duration(500).attr("r", 3)
																.attr("fill","#777777")
				}
				
				function zoomTeamDots(teamName) {
					unZoomAllDots();
					teamGroup= teamGroupDict[teamName];
					teamGroup.moveToFront();
					teamGroup.selectAll("circle")
							   .transition().delay(0).duration(500).attr("r", 10)
																.attr("fill",function(d){return colors[d3.select(this.parentNode).attr("id")];})
				}
				
				toggle.selectAll("rect")
						.data(playerStatsByTeam)
						.enter()
						.append("rect")
						//.text(function(d){return d["team"];})
						.attr("fill", function(d){return colors[d["team"]];})
						.attr("x",10)
						.attr("y",function(d,i){return 45+30*i;})
						.attr("width",30)
						.attr("height",20)
						.on("click",function(d){zoomTeamDots(d["team"]);})
				
            });
        </script>
    </body>
</html>