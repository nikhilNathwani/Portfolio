<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>ROI</title>
		<link type="text/css" rel="stylesheet" href="roi.css"/>
        <script type="text/javascript" src="../d3/d3.js"></script>
        <style type="text/css">
			text {
			    font-family: Verdana;
			}
			
			.axis line {
			    fill: none;
			    stroke: black;
			    shape-rendering: crispEdges;
			}
			
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
		</style>
    </head>
    <body>
		<div id="toggle"></div>
		<div id="graph"></div>
		<div id="profiles"></div>
        <script type="text/javascript">
            w= 700;
            h= 700;
			
			x0= -10
			xAxisLoc= 0
			xN= 35
			y0= 0
			yAxisLoc= 0
			yN= 42
			padding= 50
			t= 5;
				
			var colors= {"ATL":"#D21033", "BOS":"#05854C", "BRK":"#000000", "CHA":"#25799A", "CHI":"#D4001F", "CLE":"#9F1425", "DAL":"#006AB5", "DEN":"#4393D1", "DET":"#006BB6", "GSW":"#FFC33C", "HOU":"#CC0000", "IND":"#FFC225", "LAC":"#EE2944", "LAL":"#4A2583", "MEM":"#85A2C6", "MIA":"#B62630", "MIL":"#00330A", "MIN":"#12397F", "NOP": "#091D4A", "NYK":"#2E66B2", "OKC":"#0075C1", "ORL":"#077ABD", "PHI":"#C7974D", "PHO":"#FF7A31", "POR":"#E1393E", "SAC":"#743389", "SAS":"#BEC8C9", "TOR":"#CD1041", "UTA":"#448CCE", "WAS":"#004874"}
            
            //Create SVG element
            svg= d3.select("#graph")
                    .append("svg")
                    .attr("width",w)
                    .attr("height",h)                  
					
			//Toggle SVG
			toggle= d3.select("#toggle")
						.append("svg")
						.attr("width","215")
						.attr("height",h)
						
			//Player Profle SVG
			profiles= d3.select("#profiles")
						.append("svg")
						.attr("width","300")
						.attr("height",h)
						
            d3.json("roi.json", function(playerStatsByTeam) {
				
				//Defining the scales and axes
				var xScale = d3.scale.linear()
								.domain([x0, xN])
								.range([padding, w-padding]);		  
				var yScale = d3.scale.linear()
								.domain([y0, yN])
								.range([h-padding, padding]);
	  
				var xAxis = d3.svg.axis()
								.scale(xScale)
								.ticks(t)
								.orient("bottom")
								.tickFormat(d3.format("d"));
				var yAxis = d3.svg.axis()
								.scale(yScale)
								.ticks(t)
								.orient("left")
								.tickFormat(d3.format("d"));
	  
	  
				//Drawing rect on graph for backgroud color
				svg.append("rect")
					  .attr("id","backgroundRect")
					  .attr("x", xScale(x0))
					  .attr("y", yScale(yN))
					  .attr("width",(w-padding)-(padding))
					  .attr("height",(h-padding)-(padding))
	  
	  
				//Drawing lines on graph
				lines= svg.append("g")
							  .attr("id","lines")
	  
				verticals= lines.append("g")
								  .attr("id","verticalLines")
				verticals.selectAll("line")
						  .data(xAxis.scale().ticks(t))
						  .enter()
						  .append("line")
						  .attr("x1",function(d) {
							  return xScale(d);
						  })
						  .attr("x2",function(d) {
							  return xScale(d);
						  })
						  .attr("y1", yScale(y0))
						  .attr("y2", yScale(yN))
	  
				horizontals= lines.append("g")
								  .attr("id","horizonalLines")
				horizontals.selectAll("line")
						  .data(yAxis.scale().ticks(t))
						  .enter()
						  .append("line")
						  .attr("x1", xScale(x0))
						  .attr("x2", xScale(xN))
						  .attr("y1",function(d) {
							  return yScale(d);
						  })
						  .attr("y2",function(d) {
							  return yScale(d);
						  })
	  
				//Drawing the axes
				svg.append("g")
					.attr("class", "axis")
					.attr("id","xAxis")
					.attr("transform", "translate("+0+"," + yScale(xAxisLoc) + ")")
					.call(xAxis);
				svg.append("g")
					.attr("class", "axis")
					.attr("id","yAxis")
					.attr("transform", "translate("+ xScale(yAxisLoc) +"," + 0 + ")")
					.call(yAxis);	


				var teamGroupDict= {}
				
				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Create a group of circles for each team
				groups= svg.selectAll("g#circGroup")
							.data(playerStatsByTeam)
							.enter()
							.append("g")
							.attr("id","circGroup")
				
				groups.attr("class", function(d,i) {/*console.log(i);*/return "circs"})
						.attr("id", function(d) {
								teamGroupDict[d["team"]]= d3.select(this);
								return d["team"];
							})
				
				//Add circles to each group
				groups.selectAll("circle")
						.data(function(d) {return d["players"];})
						.enter()
						.append("circle")
						.attr("r",3)
						.attr("cx",function(d){
                                return xScale(d["ws"]);
                            })
                        .attr("cy",function(d){
                                return yScale(d["salary"]);
                            })
                        .attr("fill",function() {
								return "#777777";
							})
						.on("click",function(d) {
								setProfile(d);
							})
						
				
				
				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Create toggle and toggle functionality
				//move selected object to front of parent's layout
				d3.selection.prototype.moveToFront = function() {
					return this.each(function(){
					  this.parentNode.appendChild(this);
					});
				  };
				
				function unZoomAllDots() {
					groups.selectAll("circle")
							.transition().delay(0).duration(500).attr("r", 3)
																.attr("fill","#777777")
				}
				
				function zoomTeamDots(teamName) {
					unZoomAllDots();
					teamGroup= teamGroupDict[teamName];
					teamGroup.moveToFront();
					teamGroup.selectAll("circle")
							   .transition().delay(0).duration(500).attr("r", 10)
																.attr("fill",function(d){return colors[d3.select(this.parentNode).attr("id")];})
				}
				
				
				/*Conference titles*/
				toggle.append("text")
						.attr("fill","#AAAAAA")
						.attr("font-size", 36)
						.attr("x",90+27.5)
						.attr("y",padding)
						.attr("text-anchor","middle")
						.attr("dominant-baseline","hanging")
						.text("EAST")
						
				toggle.append("text")
						.attr("fill","#AAAAAA")
						.attr("font-size", 36)
						.attr("x",90+27.5)
						.attr("y",padding + 315)
						.attr("text-anchor","middle")
						.attr("dominant-baseline","hanging")
						.text("WEST")
				
				/*Creating the toggle buttons*/
				toggleButtons= toggle.selectAll("g.toggleButton")
										.data(playerStatsByTeam)
										.enter()
										.append("g")
										.attr("class","toggleButton")
										.style("cursor","pointer")
										.on("click",function(d){zoomTeamDots(d["team"]);});
				
				var confTitleHeight= 45;		
				
				toggleButtons.append("rect")
								.attr("fill", function(d){return colors[d["team"]];})
								.attr("x",function(d,i){return 30 + 60*Math.floor((i%15)/5);})
								.attr("y",function(d,i){return confTitleHeight + padding + 65*Math.floor(i/15) + 50*(5*Math.floor(i/15)+(i%15)%5);})
								.attr("rx", 5)
								.attr("ry", 5)
								.attr("width",55)
								.attr("height",35)
				
				toggleButtons.append("text")
								.attr("fill","white")
								.attr("font-size", 12)
								.attr("x",function(d,i){return 57.5 + 60*Math.floor((i%15)/5);})
								.attr("y",function(d,i){return confTitleHeight + padding + 17.5 + 65*Math.floor(i/15) + 50*(5*Math.floor(i/15)+(i%15)%5);})
								.attr("text-anchor","middle")
								.attr("dominant-baseline","central")
								.text(function(d){return d["team"];})
								
				
				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Player Profile section
				stats= ["Name","Win Share %","Salary %"]
				statsToID= {"Name":"name","Win Share %":"ws","Salary %":"salary"}
				profiles.selectAll("text")
						.data(stats)
						.enter()
						.append("text")
						.attr("id",function(d){return statsToID[d];})
						.attr("fill","grey")
						.attr("font-size",16)
						.attr("dominant-baseline","hanging")
						.attr("x",30)
						.attr("y",function(d,i){return padding + i*30;});
					
				function setProfile(player) {
					profiles.select("#name").text("Name: " + player["name"]);
					profiles.select("#ws").text("Win Share %: " + parseFloat(player["ws"]).toFixed(3));
					profiles.select("#salary").text("Salary %: " + parseFloat(player["salary"]).toFixed(3));
				}
				
				
				
				
				
            });
        </script>
    </body>
</html>